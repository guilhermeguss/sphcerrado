<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Earthy & grounded -->
    <!-- Application Structure Plan: A aplica√ß√£o foi estruturada como uma narrativa visual de p√°gina √∫nica com navega√ß√£o por se√ß√µes tem√°ticas. A arquitetura segue uma l√≥gica de "problema -> solu√ß√£o -> aprofundamento -> aplica√ß√£o", guiando o usu√°rio de forma intuitiva. Em vez de um scroll longo, o usu√°rio navega por abas, focando em um t√≥pico por vez (O Problema, A Solu√ß√£o, An√°lise de Dados, O Modelo, Alertas e A√ß√£o). Esta estrutura foi escolhida para transformar um relat√≥rio t√©cnico denso em uma experi√™ncia de aprendizado segmentada e de f√°cil digest√£o, permitindo que diferentes p√∫blicos (gestores, acad√™micos, estudantes) explorem as se√ß√µes de maior interesse de forma n√£o-linear. A interatividade foca em explorar os dados dos gr√°ficos e entender as categorias de alerta. Uma se√ß√£o de quiz foi adicionada ao final para refor√ßar o aprendizado. -->
    <!-- Visualization & Content Choices: 1. Report Info: Crise H√≠drica (KPI 96,9%) -> Goal: Inform -> Viz/Presentation: Grande n√∫mero destacado (HTML/CSS) -> Interaction: Est√°tico -> Justification: Cria impacto visual imediato para o problema central -> Method: HTML/Tailwind. 2. Report Info: Fluxo do Projeto -> Goal: Organize -> Viz/Presentation: Diagrama de processo (HTML/CSS) -> Interaction: Est√°tico -> Justification: Explica o pipeline do projeto de forma clara e visual sem usar SVG/Mermaid -> Method: HTML/Flexbox/Tailwind. 3. Report Info: Rela√ß√£o Chuva vs. NDVI -> Goal: Change -> Viz/Presentation: Gr√°fico combinado de barras e linhas (Chart.js) -> Interaction: Tooltip ao passar o mouse -> Justification: Mostra a correla√ß√£o e a crucial defasagem temporal de forma interativa -> Library: Chart.js/Canvas. 4. Report Info: Performance do Modelo (R¬≤) -> Goal: Inform -> Viz/Presentation: Gr√°fico de Donut (Chart.js) -> Interaction: Tooltip ao passar o mouse -> Justification: Simples e eficaz para mostrar a propor√ß√£o de vari√¢ncia explicada -> Library: Chart.js/Canvas. 5. Report Info: Import√¢ncia das Vari√°veis -> Goal: Compare -> Viz/Presentation: Gr√°fico de barras horizontais (Chart.js) -> Interaction: Tooltip ao passar o mouse -> Justification: Ideal para comparar e ranquear o impacto de cada vari√°vel no modelo -> Library: Chart.js/Canvas. 6. Report Info: N√≠veis de Alerta -> Goal: Organize/Inform -> Viz/Presentation: Cart√µes interativos (HTML/CSS) -> Interaction: Efeito de hover para destaque -> Justification: Apresenta as categorias de alerta de forma segmentada e visualmente clara -> Method: HTML/Tailwind. 7. Report Info: Quiz -> Goal: Engage/Reinforce -> Viz/Presentation: Quiz interativo (HTML/JS) -> Interaction: Sele√ß√£o de respostas e feedback -> Justification: Engaja o usu√°rio e testa o conhecimento adquirido de forma din√¢mica -> Method: HTML/JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>SPH Cerrado - An√°lise Interativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5DC; /* Beige */
            color: #4A4A4A;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 45vh;
            max-height: 450px;
        }
        .kpi-value {
            font-weight: 900;
            color: #A0522D; /* Sienna */
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
            border-bottom: 2px solid transparent;
            padding-bottom: 4px;
        }
        .nav-link.active, .nav-link:hover {
            color: #A0522D;
            border-bottom-color: #A0522D;
        }
        .section-card {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .alert-card {
            transition: all 0.3s ease-in-out;
        }
        .alert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option.selected {
            background-color: #D2B48C;
            color: white;
            border-color: #A0522D;
        }
        .quiz-option.correct {
            background-color: #8FBC8F;
            color: white;
            border-color: #2E8B57;
        }
        .quiz-option.incorrect {
            background-color: #F08080;
            color: white;
            border-color: #CD5C5C;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="font-bold text-xl text-[#A0522D]">SPH Cerrado</div>
            <div class="hidden md:flex space-x-8" id="nav-menu">
                <a href="#problema" class="nav-link font-semibold active">O Problema</a>
                <a href="#solucao" class="nav-link font-semibold">A Solu√ß√£o</a>
                <a href="#analise" class="nav-link font-semibold">An√°lise de Dados</a>
                <a href="#modelo" class="nav-link font-semibold">Modelo Preditivo</a>
                <a href="#futuro" class="nav-link font-semibold">Previs√£o Futura</a>
                <a href="#alertas" class="nav-link font-semibold">Alertas e A√ß√£o</a>
                <a href="#cidadao" class="nav-link font-semibold">Ci√™ncia Cidad√£</a>
                <a href="#quiz" class="nav-link font-semibold">Quiz</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="problema" class="min-h-[80vh] flex items-center">
            <div class="text-center w-full">
                <h1 class="text-4xl md:text-6xl font-black mb-4">A Crise H√≠drica Anunciada</h1>
                <p class="max-w-3xl mx-auto text-lg mb-8">Em 2017, o Distrito Federal enfrentou um racionamento severo de √°gua. Mas a crise n√£o foi uma surpresa. Anos antes, os sinais j√° eram claros.</p>
                <div class="section-card rounded-lg p-8 inline-block">
                    <p class="text-6xl md:text-8xl kpi-value">96,9%</p>
                    <p class="font-semibold mt-2 text-gray-700">da capacidade de fornecimento</p>
                    <p class="text-sm text-gray-500 max-w-xs mx-auto">j√° era atingida em dias de pico em 2010, segundo o TCDF, sete anos antes da crise se materializar.</p>
                </div>
            </div>
        </section>

        <section id="solucao" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Uma Nova Abordagem: Da Rea√ß√£o √† Previs√£o</h2>
            <p class="text-center max-w-3xl mx-auto mb-12">Para evitar futuras crises, o projeto SPH Cerrado prop√µe uma mudan√ßa de paradigma, integrando tecnologia de ponta e participa√ß√£o comunit√°ria para antecipar os riscos.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-center font-semibold text-sm">
                <div class="p-4 section-card rounded-lg w-full md:w-48 h-32 flex flex-col justify-center">üõ∞Ô∏è<br>Monitoramento Remoto<br><span class="text-xs font-normal text-gray-500">Dados de Sat√©lite (GEE)</span></div>
                <div class="text-2xl text-gray-400 font-sans transform md:-rotate-0 rotate-90">‚Üí</div>
                <div class="p-4 section-card rounded-lg w-full md:w-48 h-32 flex flex-col justify-center">üß†<br>Modelagem Preditiva<br><span class="text-xs font-normal text-gray-500">Machine Learning</span></div>
                <div class="text-2xl text-gray-400 font-sans transform md:-rotate-0 rotate-90">‚Üí</div>
                <div class="p-4 section-card rounded-lg w-full md:w-48 h-32 flex flex-col justify-center">üìä<br>Sistema de Alertas<br><span class="text-xs font-normal text-gray-500">Baseado em Percentis</span></div>
                <div class="text-2xl text-gray-400 font-sans transform md:-rotate-0 rotate-90">‚Üí</div>
                <div class="p-4 section-card rounded-lg w-full md:w-48 h-32 flex flex-col justify-center">üë•<br>Ci√™ncia Cidad√£<br><span class="text-xs font-normal text-gray-500">App Mangaba Cerrado</span></div>
            </div>
        </section>

        <section id="analise" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Entendendo o Pulso do Cerrado</h2>
            <p class="text-center max-w-3xl mx-auto mb-10">A an√°lise de uma d√©cada de dados de sat√©lite revela a forte sazonalidade do bioma e uma descoberta crucial: a vegeta√ß√£o n√£o responde √† chuva imediatamente. Existe uma defasagem, uma janela de tempo valiosa para a previs√£o. Passe o mouse sobre o gr√°fico para explorar os dados.</p>
            <div class="section-card rounded-lg p-6">
                <div class="chart-container">
                    <canvas id="precipNdviChart"></canvas>
                </div>
            </div>
        </section>

        <section id="modelo" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-10">O Cora√ß√£o do Sistema: O Modelo Preditivo</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                <div class="lg:col-span-1 section-card rounded-lg p-6 text-center">
                    <h3 class="font-bold text-lg mb-2">Performance do Modelo</h3>
                    <p class="text-sm text-gray-600 mb-4">O modelo Random Forest consegue explicar a maior parte da varia√ß√£o da umidade do solo.</p>
                    <div class="chart-container" style="height: 200px; max-height: 200px;">
                        <canvas id="modelAccuracyChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 section-card rounded-lg p-6">
                     <h3 class="font-bold text-lg mb-2 text-center">O Que o Modelo Aprendeu?</h3>
                    <p class="text-center text-sm text-gray-600 mb-4">A an√°lise revela que a perda de √°gua (Evapotranspira√ß√£o) e a presen√ßa de √°gua na paisagem (MNDWI) s√£o indicadores mais poderosos para prever a seca do que a pr√≥pria Precipita√ß√£o.</p>
                    <div class="chart-container" style="height: 280px; max-height: 280px;">
                        <canvas id="featureImportanceChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="futuro" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Navegando o Futuro da √Ågua</h2>
            <p class="text-center max-w-3xl mx-auto mb-10">O SPH Cerrado n√£o apenas monitora o presente, mas nos ajuda a escolher um futuro melhor. Usando o conceito do "Cone de Futuros", podemos simular cen√°rios e tomar decis√µes para alcan√ßar um futuro mais seguro e resiliente. Escolha um cen√°rio clim√°tico e veja uma simula√ß√£o para os pr√≥ximos 3 anos.</p>
            <div class="section-card rounded-lg p-6 md:p-8">
                <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-6">
                    <button onclick="runForecastSimulation('dry')" class="bg-orange-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-orange-600 transition-colors w-full md:w-auto">Cen√°rio Seco</button>
                    <button onclick="runForecastSimulation('normal')" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors w-full md:w-auto">Cen√°rio Normal</button>
                    <button onclick="runForecastSimulation('wet')" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-600 transition-colors w-full md:w-auto">Cen√°rio Chuvoso</button>
                </div>
                <div class="chart-container" style="height: 320px; max-height: 50vh;">
                    <canvas id="simulationChart"></canvas>
                </div>
                 <div id="simulationSummary" class="mt-4 text-center font-semibold">
                     <p>Selecione um cen√°rio para iniciar a simula√ß√£o.</p>
                </div>
            </div>
        </section>

        <section id="alertas" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Da Previs√£o √† A√ß√£o: O Sistema de Alertas</h2>
            <p class="text-center max-w-3xl mx-auto mb-10">As previs√µes do modelo s√£o traduzidas em um sistema de alerta de quatro n√≠veis, comparando a umidade prevista com os dados hist√≥ricos para determinar a severidade da seca. Isso permite que gestores e a comunidade tomem a√ß√µes preventivas.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <div class="alert-card bg-white p-6 rounded-lg shadow-md border-b-4 border-green-400">
                    <p class="text-2xl mb-2">‚úÖ</p>
                    <p class="font-bold text-green-700">Normal</p>
                    <p class="text-xs text-gray-500 mt-1">Condi√ß√µes de umidade adequadas para a √©poca.</p>
                </div>
                <div class="alert-card bg-white p-6 rounded-lg shadow-md border-b-4 border-yellow-400">
                    <p class="text-2xl mb-2">‚ö†Ô∏è</p>
                    <p class="font-bold text-yellow-700">Aten√ß√£o</p>
                    <p class="text-xs text-gray-500 mt-1">Solos mais secos que o normal. Risco de estresse h√≠drico.</p>
                </div>
                <div class="alert-card bg-white p-6 rounded-lg shadow-md border-b-4 border-orange-400">
                    <p class="text-2xl mb-2">üî•</p>
                    <p class="font-bold text-orange-700">Alerta</p>
                    <p class="text-xs text-gray-500 mt-1">Seca moderada. Risco de inc√™ndios e perdas agr√≠colas.</p>
                </div>
                <div class="alert-card bg-white p-6 rounded-lg shadow-md border-b-4 border-red-500">
                    <p class="text-2xl mb-2">üö®</p>
                    <p class="font-bold text-red-700">Emerg√™ncia</p>
                    <p class="text-xs text-gray-500 mt-1">Seca severa. Racionamento pode ser necess√°rio.</p>
                </div>
            </div>
        </section>
        
        <section id="cidadao" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Ci√™ncia Cidad√£ em A√ß√£o</h2>
            <p class="text-center max-w-3xl mx-auto mb-10">A tecnologia sozinha n√£o √© suficiente. A participa√ß√£o da comunidade √© a pe√ßa-chave. Atrav√©s do aplicativo Mangaba Cerrado, qualquer pessoa pode se tornar um "sentinela h√≠drico", enviando dados locais que ajudam a validar e aprimorar as previs√µes do modelo. Simule sua contribui√ß√£o abaixo.</p>
            <div class="section-card rounded-lg p-6 md:p-8 max-w-2xl mx-auto w-full">
                <div id="contribution-form-container">
                    <form id="contribution-form" class="space-y-4">
                        <div>
                            <label for="rain" class="block text-sm font-medium text-gray-700">Chuva nas √∫ltimas 24h (mm)</label>
                            <input type="number" id="rain" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-[#A0522D] focus:border-[#A0522D]" placeholder="Medido no seu pluvi√¥metro">
                        </div>
                        <div>
                            <label for="observation" class="block text-sm font-medium text-gray-700">N√≠vel do C√≥rrego/Nascente Pr√≥ximo</label>
                            <select id="observation" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-[#A0522D] focus:border-[#A0522D]">
                                <option>Normal para a √©poca</option>
                                <option>Um pouco abaixo do normal</option>
                                <option>Muito baixo</option>
                                <option>Completamente seco</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-[#A0522D] text-white font-bold py-3 px-4 rounded-lg hover:bg-[#804224] transition-colors">Enviar Observa√ß√£o</button>
                    </form>
                </div>
                 <div id="thank-you-message" class="hidden text-center">
                    <p class="text-6xl mb-4">üíß</p>
                    <h3 class="font-bold text-gray-800 text-2xl">Obrigado pela sua contribui√ß√£o!</h3>
                    <p class="text-md text-gray-600 mt-2">Seus dados ajudam a proteger as √°guas do Cerrado. Juntos, somos mais fortes.</p>
                    <button id="reset-form-btn" class="mt-6 bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-800">Enviar Nova Observa√ß√£o</button>
                </div>
            </div>
        </section>

        <section id="quiz" class="min-h-screen flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Teste Seu Conhecimento</h2>
            <p class="text-center max-w-3xl mx-auto mb-10">Agora que voc√™ explorou o projeto SPH Cerrado, teste o que aprendeu com este quiz!</p>
            <div class="section-card rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                <div id="quiz-container">
                    <div id="quiz-question" class="text-lg font-semibold text-gray-800 mb-4"></div>
                    <div id="quiz-options" class="space-y-3"></div>
                    <div id="quiz-feedback" class="mt-4 text-sm font-semibold"></div>
                    <button id="quiz-next-btn" class="mt-6 bg-[#A0522D] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#804224] transition-colors w-full" disabled>Verificar</button>
                </div>
                <div id="quiz-results" class="hidden text-center">
                    <h3 class="text-2xl font-bold mb-2">Quiz Conclu√≠do!</h3>
                    <p class="text-lg">Seu resultado: <span id="quiz-score" class="font-black"></span></p>
                    <p id="quiz-result-message" class="mt-2 text-gray-600"></p>
                    <button id="quiz-restart-btn" class="mt-6 bg-gray-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-800 transition-colors">Refazer o Quiz</button>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-white border-t py-6">
        <div class="container mx-auto px-6 text-center text-gray-600">
            <p class="font-bold">SPH Cerrado</p>
            <p class="text-sm">Uma iniciativa do Centro Educacional Dona Am√©rica Guimar√£es para o 14¬∫ Circuito de Ci√™ncias.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const reportData = {
                modelPerformance: { r2_test: 0.79 },
                featureImportance: {
                    "Evapotranspira√ß√£o": 0.412, "MNDWI": 0.317, "NDVI": 0.150,
                    "Temperatura do Ar": 0.067, "Precipita√ß√£o": 0.038
                },
                timeSeries: [
                    {"date": "2020-01-01", "precipitation_sum": 320.1, "NDVI": 0.66, "soil_moisture": 0.38},
                    {"date": "2020-02-01", "precipitation_sum": 240.2, "NDVI": 0.63, "soil_moisture": 0.36},
                    {"date": "2020-03-01", "precipitation_sum": 205.4, "NDVI": 0.59, "soil_moisture": 0.34},
                    {"date": "2020-04-01", "precipitation_sum": 115.9, "NDVI": 0.55, "soil_moisture": 0.31},
                    {"date": "2020-05-01", "precipitation_sum": 30.1, "NDVI": 0.49, "soil_moisture": 0.27},
                    {"date": "2020-06-01", "precipitation_sum": 4.5, "NDVI": 0.43, "soil_moisture": 0.25},
                    {"date": "2020-07-01", "precipitation_sum": 1.2, "NDVI": 0.38, "soil_moisture": 0.23},
                    {"date": "2020-08-01", "precipitation_sum": 15.6, "NDVI": 0.35, "soil_moisture": 0.22},
                    {"date": "2020-09-01", "precipitation_sum": 50.3, "NDVI": 0.36, "soil_moisture": 0.24},
                    {"date": "2020-10-01", "precipitation_sum": 160.7, "NDVI": 0.49, "soil_moisture": 0.30},
                    {"date": "2020-11-01", "precipitation_sum": 225.4, "NDVI": 0.61, "soil_moisture": 0.35},
                    {"date": "2020-12-01", "precipitation_sum": 285.9, "NDVI": 0.64, "soil_moisture": 0.37},
                    {"date": "2021-01-01", "precipitation_sum": 330.2, "NDVI": 0.67, "soil_moisture": 0.39},
                    {"date": "2021-02-01", "precipitation_sum": 250.8, "NDVI": 0.64, "soil_moisture": 0.37},
                    {"date": "2021-03-01", "precipitation_sum": 215.1, "NDVI": 0.60, "soil_moisture": 0.35},
                    {"date": "2021-04-01", "precipitation_sum": 120.4, "NDVI": 0.56, "soil_moisture": 0.32},
                    {"date": "2021-05-01", "precipitation_sum": 35.2, "NDVI": 0.50, "soil_moisture": 0.28},
                    {"date": "2021-06-01", "precipitation_sum": 5.8, "NDVI": 0.44, "soil_moisture": 0.26},
                    {"date": "2021-07-01", "precipitation_sum": 1.8, "NDVI": 0.39, "soil_moisture": 0.24},
                    {"date": "2021-08-01", "precipitation_sum": 18.2, "NDVI": 0.36, "soil_moisture": 0.23},
                    {"date": "2021-09-01", "precipitation_sum": 55.9, "NDVI": 0.37, "soil_moisture": 0.25},
                    {"date": "2021-10-01", "precipitation_sum": 170.3, "NDVI": 0.50, "soil_moisture": 0.31},
                    {"date": "2021-11-01", "precipitation_sum": 235.1, "NDVI": 0.62, "soil_moisture": 0.36},
                    {"date": "2021-12-01", "precipitation_sum": 295.6, "NDVI": 0.65, "soil_moisture": 0.38},
                ]
            };

            const tooltipConfig = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                }
            };

            new Chart(document.getElementById('precipNdviChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: reportData.timeSeries.map(d => new Date(d.date).toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' })),
                    datasets: [{
                        label: 'Precipita√ß√£o (mm)',
                        data: reportData.timeSeries.map(d => d.precipitation_sum),
                        backgroundColor: '#2981F6',
                        borderColor: '#2981F6',
                        yAxisID: 'y',
                        order: 2
                    }, {
                        label: 'NDVI (Sa√∫de da Vegeta√ß√£o)',
                        data: reportData.timeSeries.map(d => d.NDVI),
                        borderColor: '#8FBC8F',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        type: 'line',
                        tension: 0.4,
                        fill: false,
                        order: 1
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, ...tooltipConfig,
                    scales: {
                        y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Precipita√ß√£o (mm)', color: '#2981F6' } },
                        y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'NDVI', color: '#8FBC8F' }, grid: { drawOnChartArea: false } }
                    }
                }
            });

            new Chart(document.getElementById('modelAccuracyChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Varia√ß√£o Explicada pelo Modelo', 'N√£o Explicada'],
                    datasets: [{
                        data: [reportData.modelPerformance.r2_test * 100, (1 - reportData.modelPerformance.r2_test) * 100],
                        backgroundColor: ['#A0522D', '#EAEAEA'],
                        borderColor: ['#FFFFFF'], borderWidth: 2
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, ...tooltipConfig,
                    plugins: { ...tooltipConfig.plugins, legend: { display: false },
                        title: { display: true, text: `R¬≤ = ${reportData.modelPerformance.r2_test.toFixed(2)}`, font: { size: 24, weight: 'bold' }, color: '#A0522D' }
                    },
                    cutout: '60%'
                }
            });

            const sortedFeatures = Object.entries(reportData.featureImportance).sort(([,a],[,b]) => b-a);
            const featureColors = {
                'Evapotranspira√ß√£o': '#BDFF00',
                'MNDWI': '#21018B',
                'NDVI': '#06C664',
                'Temperatura do Ar': '#FF0000',
                'Precipita√ß√£o': '#2981F6'
            };
            const backgroundColors = sortedFeatures.map(f => featureColors[f[0]] || '#cccccc');

            new Chart(document.getElementById('featureImportanceChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: sortedFeatures.map(f => f[0]),
                    datasets: [{
                        label: 'Import√¢ncia Relativa',
                        data: sortedFeatures.map(f => f[1]),
                        backgroundColor: backgroundColors,
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false, ...tooltipConfig,
                    plugins: { ...tooltipConfig.plugins, legend: { display: false } },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'Score de Import√¢ncia' } } }
                }
            });

            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.4
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href').substring(1) === entry.target.id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
            
            // --- L√≥gica da Ci√™ncia Cidad√£ ---
            const contributionForm = document.getElementById('contribution-form');
            const formContainer = document.getElementById('contribution-form-container');
            const thankYouMessage = document.getElementById('thank-you-message');
            const resetFormBtn = document.getElementById('reset-form-btn');

            contributionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                formContainer.classList.add('hidden');
                thankYouMessage.classList.remove('hidden');
            });

            resetFormBtn.addEventListener('click', () => {
                contributionForm.reset();
                formContainer.classList.remove('hidden');
                thankYouMessage.classList.add('hidden');
            });

            // --- L√≥gica do Quiz ---
            const quizBank = [
                { question: "Qual evento hist√≥rico √© citado como a principal evid√™ncia da vulnerabilidade h√≠drica do DF?", options: ["A crise h√≠drica e o racionamento de 2017-2018.", "O relat√≥rio do TCDF de 2010.", "A expans√£o da fronteira agr√≠cola.", "A cria√ß√£o do PPCerrado."], answer: "A crise h√≠drica e o racionamento de 2017-2018." },
                { question: "Qual √© a principal plataforma de computa√ß√£o em nuvem utilizada no projeto?", options: ["Google Earth Engine (GEE).", "Amazon Web Services (AWS).", "INMET.", "Jupyter Notebook."], answer: "Google Earth Engine (GEE)." },
                { question: "Qual a rela√ß√£o temporal observada no gr√°fico entre o pico das chuvas e o pico de 'verdor' da vegeta√ß√£o (NDVI)?", options: ["Ocorrem ao mesmo tempo.", "O pico de NDVI ocorre antes da chuva.", "O pico de NDVI ocorre visivelmente ap√≥s o pico de chuvas, indicando uma defasagem.", "N√£o h√° rela√ß√£o clara."], answer: "O pico de NDVI ocorre visivelmente ap√≥s o pico de chuvas, indicando uma defasagem." },
                { question: "Qual algoritmo de machine learning foi usado para criar o modelo 'SPH Cerrado'?", options: ["Regress√£o Linear.", "Random Forest Regressor.", "Redes Neurais.", "An√°lise de Percentis."], answer: "Random Forest Regressor." },
                { question: "Qual foi a performance do modelo, medida pelo R¬≤, no conjunto de teste?", options: ["0,94.", "0,88.", "0,79.", "0,15."], answer: "0,79." },
                { question: "Qual vari√°vel se revelou a mais importante para o modelo prever a umidade do solo?", options: ["Precipita√ß√£o.", "Evapotranspira√ß√£o.", "NDVI.", "Temperatura."], answer: "Evapotranspira√ß√£o." },
                { question: "Como o sistema de alertas traduz a previs√£o num√©rica em um n√≠vel de risco?", options: ["Utilizando a metodologia de percentis hist√≥ricos.", "Atrav√©s de uma f√≥rmula de regress√£o linear.", "Com base apenas na precipita√ß√£o prevista.", "Por meio de vota√ß√£o da comunidade."], answer: "Utilizando a metodologia de percentis hist√≥ricos." },
                { question: "Qual o principal objetivo do prot√≥tipo do app 'Mangaba Cerrado'?", options: ["Substituir completamente os sat√©lites.", "Oferecer previs√£o do tempo para agricultores.", "Permitir a colabora√ß√£o da comunidade com dados locais.", "Vender imagens de sat√©lite."], answer: "Permitir a colabora√ß√£o da comunidade com dados locais." },
                { question: "O que significa validar dados de sat√©lite com 'dados terrestres'?", options: ["Comparar com dados de outro sat√©lite.", "Comparar com medi√ß√µes de esta√ß√µes do INMET em solo.", "Comparar com informa√ß√µes de drones.", "Comparar com enquetes da popula√ß√£o."], answer: "Comparar com medi√ß√µes de esta√ß√µes do INMET em solo." },
                { question: "Qual √© a principal mudan√ßa de paradigma proposta pelo projeto SPH Cerrado?", options: ["Substituir monitores humanos por IA.", "Focar exclusivamente em grandes rios.", "Sair de uma gest√£o reativa para uma proativa.", "Privatizar o monitoramento da √°gua."], answer: "Sair de uma gest√£o reativa para uma proativa." },
                { question: "Por que o Cerrado √© chamado de 'Ber√ßo das √Åguas'?", options: ["Por ter a maior quantidade de chuvas do Brasil.", "Por ser a origem de rios de 3 grandes bacias hidrogr√°ficas.", "Por conter o Aqu√≠fero Guarani em sua totalidade.", "Por ser o bioma mais √∫mido."], answer: "Por ser a origem de rios de 3 grandes bacias hidrogr√°ficas." },
                { question: "O que o MNDWI √© otimizado para detectar?", options: ["Sa√∫de da vegeta√ß√£o.", "√Åreas urbanas.", "Corpos d'√°gua.", "Temperatura do solo."], answer: "Corpos d'√°gua." },
                { question: "Qual o nome do algoritmo de Machine Learning usado no projeto?", options: ["Regress√£o Linear", "Rede Neural", "Random Forest", "K-Means"], answer: "Random Forest" },
                { question: "O que o R¬≤ de 0.79 do modelo significa?", options: ["Que o modelo est√° 79% correto.", "Que o modelo explica 79% da varia√ß√£o da umidade do solo.", "Que o modelo tem 21% de erro.", "Que 79% dos dados foram usados para treino."], answer: "Que o modelo explica 79% da varia√ß√£o da umidade do solo." },
                { question: "A metodologia de percentis hist√≥ricos serve para:", options: ["Calcular a m√©dia de chuva.", "Corrigir erros nos dados de sat√©lite.", "Prever a temperatura futura.", "Contextualizar uma previs√£o em rela√ß√£o ao passado."], answer: "Contextualizar uma previs√£o em rela√ß√£o ao passado." }
            ];

            const quizContainer = document.getElementById('quiz-container');
            const quizQuestionEl = document.getElementById('quiz-question');
            const quizOptionsEl = document.getElementById('quiz-options');
            const quizFeedbackEl = document.getElementById('quiz-feedback');
            const quizNextBtn = document.getElementById('quiz-next-btn');
            const quizResultsEl = document.getElementById('quiz-results');
            const quizScoreEl = document.getElementById('quiz-score');
            const quizResultMessageEl = document.getElementById('quiz-result-message');
            const quizRestartBtn = document.getElementById('quiz-restart-btn');

            let currentQuestionIndex = 0;
            let score = 0;
            let selectedOption = null;
            let currentQuizQuestions = [];

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function startQuiz() {
                currentQuestionIndex = 0;
                score = 0;
                shuffleArray(quizBank);
                currentQuizQuestions = quizBank.slice(0, 5);
                quizContainer.style.display = 'block';
                quizResultsEl.style.display = 'none';
                quizNextBtn.textContent = 'Verificar';
                showQuestion();
            }

            function showQuestion() {
                resetState();
                const question = currentQuizQuestions[currentQuestionIndex];
                quizQuestionEl.textContent = `(${currentQuestionIndex + 1}/${currentQuizQuestions.length}) ${question.question}`;
                
                question.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('quiz-option', 'w-full', 'p-3', 'border-2', 'rounded-lg', 'text-left', 'hover:bg-gray-100');
                    button.addEventListener('click', () => selectOption(button, option));
                    quizOptionsEl.appendChild(button);
                });
            }

            function resetState() {
                quizFeedbackEl.textContent = '';
                quizNextBtn.disabled = true;
                while(quizOptionsEl.firstChild) {
                    quizOptionsEl.removeChild(quizOptionsEl.firstChild);
                }
                selectedOption = null;
            }

            function selectOption(button, option) {
                document.querySelectorAll('.quiz-option').forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedOption = option;
                quizNextBtn.disabled = false;
            }

            function handleNextButton() {
                if (quizNextBtn.textContent === 'Verificar') {
                    checkAnswer();
                } else {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < currentQuizQuestions.length) {
                        showQuestion();
                        quizNextBtn.textContent = 'Verificar';
                    } else {
                        showResults();
                    }
                }
            }

            function checkAnswer() {
                const question = currentQuizQuestions[currentQuestionIndex];
                const isCorrect = selectedOption === question.answer;

                if (isCorrect) {
                    score++;
                    quizFeedbackEl.textContent = "Resposta Correta!";
                    quizFeedbackEl.style.color = 'green';
                } else {
                    quizFeedbackEl.textContent = `Incorreto. A resposta certa √©: ${question.answer}`;
                    quizFeedbackEl.style.color = 'red';
                }

                Array.from(quizOptionsEl.children).forEach(button => {
                    if (button.textContent === question.answer) {
                        button.classList.add('correct');
                    } else if (button.textContent === selectedOption) {
                        button.classList.add('incorrect');
                    }
                    button.disabled = true;
                });
                
                quizNextBtn.textContent = 'Pr√≥xima Pergunta';
                if (currentQuestionIndex === currentQuizQuestions.length - 1) {
                    quizNextBtn.textContent = 'Ver Resultado';
                }
            }
            
            function showResults() {
                quizContainer.style.display = 'none';
                quizResultsEl.style.display = 'block';
                quizScoreEl.textContent = `${score} / ${currentQuizQuestions.length}`;
                
                let message = "Continue estudando para aprimorar seus conhecimentos!";
                if (score === currentQuizQuestions.length) {
                    message = "Excelente! Voc√™ dominou os conceitos do projeto.";
                } else if (score >= currentQuizQuestions.length / 2) {
                    message = "Bom trabalho! Voc√™ compreendeu os pontos mais importantes.";
                }
                quizResultMessageEl.textContent = message;
            }

            quizNextBtn.addEventListener('click', handleNextButton);
            quizRestartBtn.addEventListener('click', startQuiz);

            startQuiz();

            // --- L√≥gica da Simula√ß√£o de Futuro ---
            let forecastChartInstance = null;
            window.runForecastSimulation = function(scenario) {
                const summaryElement = document.getElementById('simulationSummary');
                
                const historicalMoisture = reportData.timeSeries.map(d => d.soil_moisture);
                const sortedMoisture = [...historicalMoisture].sort((a, b) => a - b);
                
                const p10 = sortedMoisture[Math.floor(sortedMoisture.length * 0.1)];
                const p20 = sortedMoisture[Math.floor(sortedMoisture.length * 0.2)];
                const p30 = sortedMoisture[Math.floor(sortedMoisture.length * 0.3)];

                const monthlyPrecipAvg = Array(12).fill(0).map((_, month) => {
                    const monthData = reportData.timeSeries.filter(d => new Date(d.date).getMonth() === month);
                    return monthData.reduce((sum, d) => sum + (d.precipitation_sum || 0), 0) / (monthData.length || 1);
                });

                let precipScenario = [...monthlyPrecipAvg];
                if (scenario === 'dry') precipScenario = monthlyPrecipAvg.map(p => p * 0.7); 
                else if (scenario === 'wet') precipScenario = monthlyPrecipAvg.map(p => p * 1.3); 

                let lastMoisture = reportData.timeSeries[reportData.timeSeries.length - 1].soil_moisture;
                const forecast = [];
                const forecastLabels = [];
                const startDate = new Date(reportData.timeSeries[reportData.timeSeries.length - 1].date);
                let alertCounts = { attention: 0, alert: 0, emergency: 0 };

                for (let i = 1; i <= 36; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setMonth(startDate.getMonth() + i);
                    const month = currentDate.getMonth();
                    const precip = precipScenario[month];
                    
                    let nextMoisture = lastMoisture * 0.5 + precip * 0.0005 + 0.1;
                    nextMoisture = Math.max(0.15, Math.min(nextMoisture, 0.42)); 
                    
                    forecast.push(nextMoisture);
                    forecastLabels.push(currentDate.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' }));
                    lastMoisture = nextMoisture;

                    if(nextMoisture < p10) alertCounts.emergency++;
                    else if(nextMoisture < p20) alertCounts.alert++;
                    else if(nextMoisture < p30) alertCounts.attention++;
                }

                const ctx = document.getElementById('simulationChart').getContext('2d');
                if(forecastChartInstance) forecastChartInstance.destroy();
                
                forecastChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: forecastLabels,
                        datasets: [{
                            label: 'Umidade do Solo Prevista', data: forecast,
                            borderColor: '#A0522D', backgroundColor: 'rgba(160, 82, 45, 0.1)',
                            borderWidth: 2, pointRadius: 1, fill: true, tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { y: { title: { display: true, text: 'Umidade do Solo (m¬≥/m¬≥)' }, min: 0.1, max: 0.45 } },
                        plugins: {
                            legend: { display: false },
                            annotation: {
                                annotations: {
                                    emergency: { type: 'box', yMin: 0.1, yMax: p10, backgroundColor: 'rgba(239, 68, 68, 0.2)'},
                                    alert: { type: 'box', yMin: p10, yMax: p20, backgroundColor: 'rgba(249, 115, 22, 0.2)'},
                                    attention: { type: 'box', yMin: p20, yMax: p30, backgroundColor: 'rgba(234, 179, 8, 0.2)'},
                                    normal: { type: 'box', yMin: p30, yMax: 0.45, backgroundColor: 'rgba(34, 197, 94, 0.1)'}
                                }
                            }
                        }
                    }
                });
                
                summaryElement.innerHTML = `No <span class="font-bold">${scenario === 'dry' ? 'Cen√°rio Seco' : (scenario === 'wet' ? 'Cen√°rio Chuvoso' : 'Cen√°rio Normal')}</span>, o sistema entraria em estado de 
                <span class="text-yellow-600 font-bold">Aten√ß√£o por ${alertCounts.attention} meses</span>, 
                <span class="text-orange-600 font-bold">Alerta por ${alertCounts.alert} meses</span> e 
                <span class="text-red-600 font-bold">Emerg√™ncia por ${alertCounts.emergency} meses</span> ao longo dos pr√≥ximos 3 anos.`;
            }
        });
    </script>
</body>
</html>
